Index: CarParkAutomatisation/Veritabani.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using System;\r\nusing System.Collections.Generic;\r\nusing System.ComponentModel;\r\nusing System.Data;\r\nusing System.Drawing;\r\nusing System.Linq;\r\nusing System.Runtime.CompilerServices;\r\nusing System.Text;\r\nusing System.Threading.Tasks;\r\nusing System.Windows.Forms;\r\nusing MetroFramework;\r\nusing MySql.Data.MySqlClient;\r\n\r\nnamespace CarParkAutomatisation\r\n{\r\n    public static class Veritabani\r\n    {\r\n        private static string baglantiString = \"server=127.0.0.1;uid=root;pwd=.zahid746.;database=vtproje\";\r\n        private static MySqlConnection baglanti;\r\n        private static MySqlCommand komut;\r\n        private static MySqlDataAdapter adaptor;\r\n        private static MySqlDataReader dataReader;\r\n        private static DataSet dataSet;\r\n        private static string[] uyeOlDizi;\r\n        private static int idTemp;\r\n        private static string sifreTemp;\r\n        // fatura fonk icin gerekli degiskenler:\r\n        private static DateTime? girisSaati;\r\n        private static DateTime? cikisSaati;\r\n        private static string sorgu1;\r\n        private static string sorgu2;\r\n        private static string sorgu3;\r\n        private static string sorgu4;\r\n        private static string sorgu5;\r\n        private static string sorgu6;\r\n        private static string sorgu7;\r\n        \r\n        \r\n        \r\n\r\n        public static void Baglan()\r\n        {\r\n            try\r\n            {\r\n                baglanti = new MySqlConnection(baglantiString);\r\n                baglanti.Open();\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n            }\r\n\r\n            MessageBox.Show(\"Veritabanı Bağlantı Durumu: \" + baglanti.State);\r\n\r\n        }\r\n\r\n        public static bool PersonelKontrol(string komutString, string[] personelGirisBilgi)\r\n        {\r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                idTemp = Convert.ToInt32(komut.ExecuteScalar());\r\n                if (idTemp != Convert.ToInt32(personelGirisBilgi[0])) return false;\r\n                komutString = \"select perSifre from personel where perSifre\" + \"='\" + personelGirisBilgi[1] + \"'\";\r\n                komut.CommandText = komutString;\r\n                sifreTemp = komut.ExecuteScalar().ToString();\r\n                return sifreTemp==personelGirisBilgi[1];\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n            }\r\n            return false;\r\n        }\r\n        \r\n        public static bool UyeKontrol(string komutString, string[] uyeGirisBilgi)\r\n        {\r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                idTemp = Convert.ToInt32(komut.ExecuteScalar());\r\n                if (idTemp != Convert.ToInt32(uyeGirisBilgi[0])) return false;\r\n                komutString = \"select uyeSifre from uyeler where uyeSifre\" + \"='\" + uyeGirisBilgi[1] + \"'\";\r\n                komut.CommandText = komutString;\r\n                sifreTemp = komut.ExecuteScalar().ToString();\r\n                return sifreTemp==uyeGirisBilgi[1];\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n            }\r\n            return false;\r\n        }\r\n\r\n        public static int PlakaGetir(string komutString)\r\n        {\r\n            int plakaid = 0;\r\n            \r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                plakaid = Convert.ToInt32(komut.ExecuteScalar());\r\n                return plakaid;\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n                return plakaid;\r\n            }\r\n        }\r\n\r\n        public static void PlakaEkle(string komutString, string plaka)\r\n        {\r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                komut.Parameters.Add(\"@plaka\", MySqlDbType.VarChar).Value = plaka.ToUpper();\r\n                komut.ExecuteNonQuery();\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n            }\r\n        }\r\n\r\n        public static DataSet Sorgu(string komutString)\r\n        {\r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                adaptor = new MySqlDataAdapter(komut);\r\n                dataSet = new DataSet();\r\n                adaptor.Fill(dataSet, \"sorguSonuc\");\r\n                return dataSet;\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message);\r\n                return new DataSet();\r\n            }\r\n            \r\n        }\r\n\r\n        public static void KayitOlInsert(string komutString, string parametreler)\r\n        {\r\n            try\r\n            {\r\n                komut = new MySqlCommand(komutString, baglanti);\r\n                uyeOlDizi = parametreler.Split(' ');\r\n                komut.Parameters.Add(\"@uyeSifre\", MySqlDbType.VarChar).Value = uyeOlDizi[0];\r\n                komut.Parameters.Add(\"@ad\", MySqlDbType.VarChar).Value = uyeOlDizi[1];\r\n                komut.Parameters.Add(\"@soyad\", MySqlDbType.VarChar).Value = uyeOlDizi[2];\r\n                komut.Parameters.Add(\"@telno\", MySqlDbType.Int64).Value = Convert.ToInt64(uyeOlDizi[3]);\r\n                komut.Parameters.Add(\"@uyelikbaslangici\", MySqlDbType.DateTime).Value =\r\n                    Convert.ToDateTime(uyeOlDizi[4]+\" \"+uyeOlDizi[5]);\r\n                komut.Parameters.Add(\"@plakaId\", MySqlDbType.Int32).Value = Convert.ToInt32(uyeOlDizi[6]);\r\n                komut.ExecuteNonQuery();\r\n                /*adaptor = new MySqlDataAdapter(komut);\r\n                dataSet = new DataSet();\r\n                adaptor.Fill(dataSet, \"sorguSonuc\");*/\r\n            }\r\n            catch (Exception e)\r\n            {\r\n                MessageBox.Show(e.Message + Environment.NewLine + e.Data);\r\n            }\r\n        }\r\n\r\n        public static void Faturalandir(string aracplaka,string yer)\r\n        {\r\n            //plakaId, parkId, girisSaati, ucret\r\n            \r\n            int plaka2 = 0;\r\n            int kisiId = 0;\r\n            double ucretid = 0;\r\n            bool parkyeridurum = true;\r\n            int parkid = 0;\r\n            \r\n            //bu fonksiyon, yer seçimi tiklandiginda acilmasi icin her butonun click olayına eklenecektir\r\n            girisSaati = DateTime.Now;\r\n            sorgu1 = \"select plakaId from plakalar where plaka\" + \"='\"+aracplaka+\"'\";\r\n            komut = new MySqlCommand(sorgu1,baglanti);\r\n            plaka2 = Convert.ToInt32(komut.ExecuteScalar()); // giris yapan aracın plakaId si alindi.\r\n            MessageBox.Show(\"plaka2:\" + plaka2);\r\n            \r\n            sorgu3 = \"select uyeId from uyeler where plakaId\" + \"='\"+plaka2+\"'\"; \r\n            komut = new MySqlCommand(sorgu3,baglanti);\r\n            kisiId = Convert.ToInt32(komut.ExecuteScalar()); // giris yapan arac sahibinin  uyeId si alindi.\r\n            MessageBox.Show(\"kişi id:\" + kisiId);\r\n\r\n            if (kisiId!=0) // kisiye kesilecek ucret belirlendi. \r\n            {\r\n                sorgu2 = \"select ucretId from ucretlendirmeler where ucretId=1\";\r\n                komut = new MySqlCommand(sorgu2,baglanti);\r\n                ucretid = Convert.ToInt32(komut.ExecuteScalar());\r\n            }\r\n            else\r\n            {\r\n                sorgu4 = \"select ucretid from ucretlendirmeler where ucretId=2\";\r\n                komut = new MySqlCommand(sorgu4,baglanti);\r\n                ucretid = Convert.ToInt32(komut.ExecuteScalar());\r\n            }\r\n            \r\n            //parkyerleri tablosuna park yerini ve park durumunu dolu olarak gir.\r\n\r\n            sorgu5 = \"insert into parkyerleri (parkyeri, parkyeridurum) values(@parkyeri, @parkyeridurum);\";\r\n            komut = new MySqlCommand(sorgu5,baglanti);\r\n            komut.Parameters.Add(\"@parkyeri\", MySqlDbType.VarChar).Value = yer;\r\n            komut.Parameters.Add(\"@parkyeridurum\", MySqlDbType.UInt16).Value = parkyeridurum;\r\n            komut.ExecuteNonQuery();\r\n            \r\n            // park yeri girildi. simdi o park yerine ait id alınacak.\r\n            sorgu6 = \"select parkId from parkyerleri where parkyeri\" + \"='\"+yer+\"'\";\r\n            komut = new MySqlCommand(sorgu6,baglanti);\r\n            parkid = Convert.ToInt32(komut.ExecuteScalar()); // aracın park edildigi id alindi.\r\n            \r\n            // toplanan bilgileri o plakaId sayesinde giriscikis tablosuna gir.\r\n\r\n            sorgu7 =\r\n                \"insert into giriscikis (plakaId, parkId, girisSaati, ucretId) values(@plakaId, @parkId, @girisSaati, @ucretId);\";\r\n            komut = new MySqlCommand(sorgu7,baglanti);\r\n            komut.Parameters.Add(\"@plakaId\", MySqlDbType.Int32).Value = plaka2;\r\n            komut.Parameters.Add(\"@parkId\", MySqlDbType.Int32).Value = parkid;\r\n            komut.Parameters.Add(\"@girisSaati\", MySqlDbType.DateTime).Value = girisSaati;\r\n            komut.Parameters.Add(\"@ucretId\", MySqlDbType.Int32).Value = ucretid;\r\n            komut.ExecuteNonQuery();\r\n        }\r\n\r\n        public static void FaturaKes(string sorgu, string aracplaka)\r\n        {\r\n            komut = new MySqlCommand(sorgu,baglanti);\r\n            girisSaati = Convert.ToDateTime(komut.ExecuteScalar());\r\n            if (girisSaati.HasValue)\r\n            {\r\n                cikisSaati = DateTime.Now; // bu deger alindi, veritabanina girilecek\r\n                TimeSpan? parkSuresi = cikisSaati - girisSaati;\r\n                TimeSpan timeSpan = parkSuresi.Value;\r\n                \r\n                // DateTime tmp = Convert.ToDateTime(timeSpan); \r\n                // string saat = Convert.ToString(timeSpan.Hours);\r\n                // string dakika = Convert.ToString(timeSpan.Minutes);\r\n                \r\n                double toplamParkSuresi = timeSpan.TotalMinutes; // park suresi de alindi veritabanına girilebilir.\r\n\r\n                //komut.CommandText = \"insert into girisCikis (cikisSaati, parkSuresi) values(@cikisSaati, @parkSuresi);\";\r\n                //komut.Parameters.Add(\"@cikisSaati\", MySqlDbType.DateTime).Value = cikisSaati;\r\n                //komut.Parameters.Add(\"@parkSuresi\", MySqlDbType.Double).Value = toplamParkSuresi;\r\n                //komut.ExecuteNonQuery(); // girisCikis tablosu tamamen doldu. \r\n                \r\n                 komut.CommandText = \"update girisCikis \"+\"set cikisSuresi=\"+cikisSaati+\", parkSuresi=\" +\r\n                                     toplamParkSuresi+\"where faturaId=(select max(faturaId) from girisCikis where plakaId='\"+aracplaka+\"'\";\r\n                 komut.ExecuteNonQuery();\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- CarParkAutomatisation/Veritabani.cs	(revision df15c432407ac372b65dd49c7f0b44416e20cb1c)
+++ CarParkAutomatisation/Veritabani.cs	(date 1590080744309)
@@ -249,6 +249,16 @@
                  komut.CommandText = "update girisCikis "+"set cikisSuresi="+cikisSaati+", parkSuresi=" +
                                      toplamParkSuresi+"where faturaId=(select max(faturaId) from girisCikis where plakaId='"+aracplaka+"'";
                  komut.ExecuteNonQuery();
+                 komut.CommandText =
+                     "select ucret from ucretlendirmeler,girisCikis where girisCikis.faturaId"+"="+"(select "+"max(faturaId) "+"from girisCikis "+
+                     "where plakaId=" + "'" + aracplaka + "') and girisCikis.ucretId=ucretlendirmeler.ucretId";
+                 double tarife = Convert.ToDouble(komut.ExecuteScalar());
+                 double ucret = (toplamParkSuresi / 60) * tarife;
+                 if (toplamParkSuresi%60>30)
+                 {
+                     ucret += tarife / 2;
+                 }
+
             }
 
         }
diff --git .idea/.idea.CarParkAutomatisation/.idea/shelf/Uncommitted_changes_before_Update_at_21_05_2020_19_28__Default_Changelist_.xml .idea/.idea.CarParkAutomatisation/.idea/shelf/Uncommitted_changes_before_Update_at_21_05_2020_19_28__Default_Changelist_.xml
